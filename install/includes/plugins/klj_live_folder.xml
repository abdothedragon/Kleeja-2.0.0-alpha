<?xml version="1.0" encoding="utf-8"?>
<kleeja>
	<info>
	  <plugin_name>Kleeja Live Folder name</plugin_name>
	  <plugin_version>1.5</plugin_version>
	  <plugin_description>نقل الصور والملفات التي تحمل صيغ معينه إلى مجلد خاص وعرضها برابط مباشر</plugin_description>
	  <plugin_author>http://www.kleeja.com</plugin_author>
	  <plugin_kleeja_version>1.0.0</plugin_kleeja_version>
	</info>

	<install><![CDATA[
		add_config('imagefolder','uploads','40','<input type="text" id="imagefolder" name="imagefolder" value="{con.imagefolder}" size="40">', 'KLIVE');
		add_config('imagefolderexts','png,gif,jpg,jpeg,tif,tiff,swf','40','<input type="text" id="imagefolderexts" name="imagefolderexts" value="{con.imagefolderexts}" size="80">', 'KLIVE');
		add_config('imagefoldere','1','40','<label>{lang.YES}<input type="radio" id="imagefoldere" name="imagefoldere" value="1"  <IF NAME="con.imagefoldere"> checked="checked"</IF>></label><label>{lang.NO}<input type="radio" id="imagefoldere" name="imagefoldere" value="0"  <IF NAME="con.imagefoldere"> <ELSE> checked="checked"</IF>></label>', 'KLIVE');
						add_olang(array(
						"IMAGEFOLDER" => "مجلد الصور والملفات المباشره",
						"IMAGEFOLDEREXTS" => "صيغ الصور والملفات المباشره",
						"IMAGEFOLDERE" => "تغيير اسم الملف او الصوره المباشره",
						"CONFIG_KLJ_MENUS_KLIVE" => "اعدادات اضافة الصور والملفات بروابط مباشرة",
					), 'ar');
		add_olang(array(
					"IMAGEFOLDER" => "Image folder",
					"IMAGEFOLDEREXTS" => "Extension of the direct files",
					"IMAGEFOLDERE" => "Change image name",
					"CONFIG_KLJ_MENUS_KLIVE" => "Kleeja Live links settings",
					), 'en');
	  ]]>
	</install>

	<uninstall><![CDATA[
		delete_config(array('imagefolder', 'imagefoldere', 'imagefolderexts',));
		delete_olang(array('IMAGEFOLDER', 'IMAGEFOLDERE', 'IMAGEFOLDEREXTS', 'CONFIG_KLJ_MENUS_KLIVE'),'ar');
		delete_olang(array('IMAGEFOLDER', 'IMAGEFOLDERE', 'IMAGEFOLDEREXTS', 'CONFIG_KLJ_MENUS_KLIVE'),'en');
	  ]]>
	</uninstall>

  <hooks>
	<hook name="while_klj_clean_old_files_func"><![CDATA[
	if(in_array($row['type'], $exlive_types))
	{
		$ex_ids[] = $row['id'];
		if($real_num != $num_of_files_to_delete)
		{
			continue;
		}
	}
	]]></hook>
  <hook name="beforewhile_klj_clean_old_files_func"><![CDATA[
  $exlive_types = explode(',', $config['imagefolderexts']);
	]]></hook>
  	<hook name="kleeja_get_link_func"><![CDATA[
  	if(isset($extra['::NAME::']))
	{
		if($config['mod_writer'] && !empty($extra['::NAME::']) && $config['id_form'] != 'direct')
		{
			$ext = @explode("-", $extra['::NAME::']);
		}
		else
		{
			$ext = @explode(".", $extra['::NAME::']);
		}

		
		$ext = $ext[sizeof($ext)-1];
		$ex	= explode(',',$config['imagefolderexts']);
		
		if(in_array(strtolower($ext), $ex))
		{
			
			if($config['mod_writer'] && !empty($extra['::NAME::']) && $config['id_form'] != 'direct')
			{
				$extra['::NAME::'] = str_replace('-', '.', $extra['::NAME::']);	
			}
			
			$links = array_merge($links, array(
						'thumb' => '::DIR::/thumbs/::NAME::',
						'image' => '::DIR::/::NAME::',
						'file'	=> '::DIR::/::NAME::',
						));
		}
	}
	]]></hook>
	<hook name="start_upload_wut2_kljuploader"><![CDATA[
	$ex	= explode(',',$config['imagefolderexts']);
	if (in_array(strtolower($this->typet), $ex))
	{
		if($config['imagefoldere'])
		{
			$zaid = time();
			$this->filename2 = $this->filename . $zaid . $i . '.' . $this->typet;
		}
		
		$this->folder = $config['imagefolder'];
	}
	else
	{
		$this->folder = $config['foldername']; //default folder (fix bug #435)
	}
	]]></hook>
	<hook name="move_uploaded_file_kljuploader"><![CDATA[
	$ex	= explode(',',$config['imagefolderexts']);
	if (in_array(strtolower($this->typet), $ex))
	{
		if($config['imagefoldere'])
		{
			$zaid = time();
			$this->filename2 = $this->filename . $zaid . $i . '.' . $this->typet;
		}
		
		$this->folder = $config['imagefolder'];
	}
	else
	{
		$this->folder = $config['foldername']; //default folder (fix bug #435)
	}
	]]></hook>
   </hooks>
</kleeja>